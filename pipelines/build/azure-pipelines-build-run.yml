trigger:
  branches:
    include:
      - main
      - development
      - release/*

schedules:
  - cron: "0 2 * * *"  # Runs daily at 2:00 AM UTC
    displayName: Daily 2AM Run
    branches:
      include:
        - main
    always: true  # Ensures it runs even if there are no code changes

pr:
  branches:
    include:
      - '*'
  paths:
    include:
      - src/**
      - TestFiles/**

variables:
  - group: CONTINUOUS_CLEARING_TOOL_TEST_CONFIG


stages:
    ##################################################
    #                    NPM                         #
    ##################################################
  - template: ../templates/build/azure-pipelines-clearing-tool-build-run-stage-template.yml
    parameters:
      stageName: npm
      displayName: "B&R CA Tool NPM"
      sw360Url: $(SW360_URL)
      sw360Token: $(SW360_TOKEN)
      sw360ProjectId: 80ea2219c1dc488c867ba952d578b053
      sw360ProjectName: "Test-NPM"
      fossologyUrl: $(FOSSOLOGY_URL)
      JfrogUrl: $(JFROG_URL)
      JfrogToken: $(JFROG_TOKEN)
      JfrogDryRun: true
      projectDefinitions:
        - projectType: 'npm'
          inputFolder: $(Build.SourcesDirectory)/ca-tool-config-and-testdata/dependency-locks/npm
      outputFolder: $(Build.SourcesDirectory)/continuous-clearing
      appSettingsPath: $(Build.SourcesDirectory)/ca-tool-config-and-testdata/settings/appsettings.json
